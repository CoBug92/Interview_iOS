## –ß—Ç–æ —Ç–∞–∫–æ–µ `—Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥–æ–Ω–∫–∏`?

[**–í–µ—Ä–Ω—É—Ç—Å—è –∫ —Å–ø–∏—Å–∫—É –≤–æ–ø—Ä–æ—Å–æ–≤**](https://github.com/CoBug92/Interview_iOS/blob/master/README.md)

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ–¥–∞ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞–±–æ—Ç—ã –¥—Ä—É–≥–æ–≥–æ. –ò –µ—Å–ª–∏ –º—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–µ–º –∫–æ–¥, –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—Å—è, —á—Ç–æ
—Ä–∞–∑–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è, –∏ –ø–æ—Ç–æ–∫ –∑–∞–≤–∏—Å—è—â–∏–π –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥—Ä—É–≥–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.

–ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ: –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–º –ø—Ä–∏—á–∏–Ω–∞–º –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ù–æ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç–ª–∞–¥–∏—Ç—å - –ø—Ä–æ–≥—Ä–∞–º–º–∞ –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤–µ—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ –≤–æ –≤—Ä–µ–º—è –æ—Ç–ª–∞–¥–∫–∏, –ø–æ—Ç–æ–∫ —É—Å–ø–µ–µ—Ç –≤—ã–¥–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –¢–∞–∫–∂–µ –æ—à–∏–±–∫–∞ –º–æ–∂–µ—Ç –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ª—É—á–∞–µ —Å –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ –Ω–æ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ. –í —Å—Ç–∞—Ä–æ–º –±—ã–ª –±–æ–ª–µ–µ —Å–ª–∞–±—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–ª–æ –∫–∞–∫ –Ω–∞–¥–æ, –∞ –Ω–∞ –Ω–æ–≤–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –æ–¥–Ω–æ–º –∏–∑ 1000 —Å–ª—É—á–∞–µ–≤ –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è.

–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—Ç–∞–≤–∏—Ç—å "–±–∞—Ä—å–µ—Ä—ã" (–≤ `GCD`) –∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π (`NSOperationQueue`), —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞—á–∏–Ω–∞—é—Ç –≤ –ø–æ—Ç–æ–∫–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ —Å—Ç–∞–≤–∏—Ç—å —Ç–æ—Ä–º–æ–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –¥—Ä—É–≥–∏–µ –ø–æ—Ç–æ–∫–∏ —É—Å–ø–µ–ª–∏ –¥–æ–∫–∞—á–∞—Ç—å—Å—è –ª–∏–±–æ –∫–∞–∫-—Ç–æ –∏–Ω–∞—á–µ –∏–∑–≤—Ä–∞—â–∞—é—Ç—Å—è.


–ú—ã –º–æ–∂–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø—Ä–æ—Å—Ç–µ–π—à–∏–π —Å–ª—É—á–∞–π race condition, –µ—Å–ª–∏ –±—É–¥–µ–º –∏–∑–º–µ–Ω—è—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é value –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –Ω–∞ private –æ—á–µ—Ä–µ–¥–∏, –∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å value –Ω–∞ —Ç–µ–∫—É—â–µ–º –ø–æ—Ç–æ–∫–µ:

‚Äò‚Äô‚ÄôSwift

print("--- –ò–º–∏—Ç–∞—Ü–∏—è race condition ---")
var value = "üòá"
func changeValue(variant: Int) {
    sleep(1)
    value = value + "üêî"; print ("\(value) - \(variant)");
}
//: –ó–∞–ø—É—Å–∫–∞–µ–º `changeValue()` –ê–°–ò–ù–•–†–û–ù–ù–û –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `value` –Ω–∞ —Ç–µ–∫—É—â–µ–º –ø–æ—Ç–æ–∫–µ
mySerialQueue.async {
    changeValue(variant: 1)
}
value
//: –¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏–º `value`, –∞ –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏–º `changeValue()` __–°–ò–ù–•–†–û–ù–ù–û__, –±–ª–æ–∫–∏—Ä—É—è —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –∑–∞–¥–∞–Ω–∏–µ `changeValue` –Ω–µ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è, —É–±–∏—Ä–∞—è —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º 
race condition:
value = "ü¶ä"
mySerialQueue.sync {
    changeValue(variant:2)
}
value
sleep(3)
‚Äò‚Äô‚Äô

–£ –Ω–∞—Å –µ—Å—Ç—å –æ–±—ã—á–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è value –∏ –æ–±—ã—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è changeValue –¥–ª—è –µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –ø—Ä–∏—á–µ–º —É–º—ã—à–ª–µ–Ω–Ω–æ –º—ã —Å–¥–µ–ª–∞–ª–∏ —Å –ø–æ–º–æ—â—å—é –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ sleep(1) —Ç–∞–∫, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π value —Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –ï—Å–ª–∏ –º—ã –±—É–¥–µ–º –∑–∞–ø—É—Å–∫–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é changeValue –ê–°–ò–ù–•–†–û–ù–ù–û —Å –ø–æ–º–æ—â—å—é async, —Ç–æ –ø—Ä–µ–∂–¥–µ, —á–µ–º –¥–æ–π–¥–µ—Ç –¥–µ–ª–æ –¥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π value, –Ω–∞ —Ç–µ–∫—É—â–µ–º –ø–æ—Ç–æ–∫–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è value –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —ç—Ç–æ –∏ –µ—Å—Ç—å race condition.

–î–∞–≤–∞–π—Ç–µ –∑–∞–º–µ–Ω–∏–º –º–µ—Ç–æ–¥ async –Ω–∞ sync:

‚Äò‚Äô‚ÄôSwift
//: –ó–∞–ø—É—Å–∫–∞–µ–º `changeValue()` –°–ò–ù–•–†–û–ù–ù–û –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `value` –Ω–∞ —Ç–µ–∫—É—â–µ–º –ø–æ—Ç–æ–∫–µ
print("--- –£–±–∏—Ä–∞–µ–º race condition —Å –ø–æ–º–æ—â—å—é sync---")
value = "üòá"
mySerialQueue.sync {
    changeValue(variant: 1)
}
value
//: –¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏–º `value`, –∞ –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏–º `changeValue()` __–°–ò–ù–•–†–û–ù–ù–û__, –±–ª–æ–∫–∏—Ä—É—è —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –∑–∞–¥–∞–Ω–∏–µ `changeValue` –Ω–µ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è, —É–±–∏—Ä–∞—è —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º 
race condition:
value = "ü¶ä"
mySerialQueue.sync {
    changeValue(variant:2)
}
value
sleep(2)
‚Äò‚Äô‚Äô

–ú—ã –≤–∏–¥–∏–º, —á—Ç–æ —Ö–æ—Ç—è –Ω—É–∂–Ω–æ –±—ã—Ç—å –æ—á–µ–Ω—å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–º —Å –º–µ—Ç–æ–¥–æ–º sync –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π, –ø–æ—Ç–æ–º—É —á—Ç–æ ¬´—Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫¬ª –≤—ã–Ω—É–∂–¥–µ–Ω –∂–¥–∞—Ç—å –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –¥—Ä—É–≥–æ–π –æ—á–µ—Ä–µ–¥–∏, –º–µ—Ç–æ–¥ sync –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω—ã–º –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å race conditions.

### –°—Ç–∞—Ç—å–∏ –ø–æ —Ç–µ–º–µ
[–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å](https://habrahabr.ru/post/320152/)